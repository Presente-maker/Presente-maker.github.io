const mensagens = [
    //1
    "Oi minha princesa, este mini projetinho é para o mês mais especial do ano, o mês em que comemoramos 1 ano de namoro, nessa primeira cartinha não irei me estender muito apenas para te deixar na curiosidade. Espero que a senhorita não roube e veja no códido todas as mensagens de uma vez. Eu te amo muito e espero que a declaração diária durante este mês te deixe feliz.💜",
    //2
    "Meu amor, hoje quero te dizer o quanto você ilumina meus dias. Desde que você entrou na minha vida, tudo ganhou mais cor, mais significado. Seu sorriso é meu conforto, seu abraço é meu refúgio, e seu amor é a força que me move.Você não imagina o bem que me faz só por existir. Sua voz acalma meus medos, sua risada contagia minha alma, e sua presença transforma até os dias mais cinzas em algo especial. É como se o universo tivesse me dado um presente que eu nem sabia que precisava, mas que agora não consigo mais viver sem. Eu te amo não só pelo que você é, mas pelo que eu me torno quando estou com você.",
    //3
    "Minha princesa, hoje quero te dizer que ter você é o maior presente que a vida me deu. Cada instante ao seu lado é como uma página de um conto perfeito, e o melhor é pensar que essa história está só começando. Eu amo o jeito que você me olha, como se eu fosse seu mundo inteiro. Amo nossos planos bobos, nossos sonhos e até os silêncios que a gente compartilha, porque tudo com você faz sentido. Quero acordar com você todos os dias, ver seu sorriso antes mesmo do café, construir uma vida cheia de memórias e conquistas juntos. Quero envelhecer ao seu lado e, mesmo daqui a 50 anos, ainda te olhar com o mesmo amor e admiração de hoje. Eu te amo hoje, amanhã e em todos os capítulos que ainda vamos escrever. ",
    //4
    "Acordar e lembrar que você é minha namorada é como ganhar um presente novo todo dia. Você sabe aquela sensação de tomar um leite quente numa manhã/dia frio? É assim que meu coração fica quando penso em você. Eu amo os detalhes que fazem a gente ser a gente, o jeito que você me manda dorme bem mesmo quando tá com sono, nossas conversas sem pé nem cabeça até o meio da madrugada, como seu abraço parece ajustar perfeitamente no meu. Mas o que mais me derrete é saber que, não importa o dia que eu tiver, sempre vou ter você do meu lado, a minha torcedora favorita, minha parceira de aventuras e minha cúmplice em tudo. Hoje só queria mesmo dizer: obrigado por existir do jeito que você existe. Meu mundo é infinitamente melhor com você nele. Te amo mais que ontem, mas menos que amanhã.☺💜",
    //5
    "Meu amor, não existe sensação no mundo que se compare à de ficar acordado te observando dormir. Quando a noite cai e a gente se enrola nos cobertores, eu me permito um luxo que só você me dá que é a de fazer carinho no seu cabelo devagar, sentir sua respiração ficando calma, e assistir seus olhos pesarem até você fugir pro mundo dos sonhos (com direito a musicas de ninar). É como se, naqueles minutos, o tempo parasse só pra gente.  E quando o sol nasce meu coração dispara, acordar e olhar pro lado, ainda com sono, e te ver ali, toda linda amassadinha do sono me lembra que o universo me deu um presente que eu nem merecia. As vezes fico uns minutinhos só te admirando, pensando 'Como alguém pode ser tão perfeita?'. Você não faz ideia do poder que tem de transformar uma simples noite de sono num momento mágico. Eu poderia passar mil vidas repetindo isso e nunca cansaria. Obrigado por ser meu aconchego e meu melhor 'bom dia' (todos os dias remotamente e alguns dias pessoalmente). Eu te amo muitão (Caso queira saber sobre a musica mande mensagem ao SAC)",
    //6
    "(Parafraseando o que o Peter Parker disse um dia para Mary Jane) Meu amor, a melhor coisa em você não é só seu sorriso, seu jeito ou seu abraço, é quando nossos olhos se encontram e, por um segundo, o mundo para. É aí que eu sinto que sou mais forte, pois seu amor me dá coragem de ser quem eu nunca fui. Mais fraco, porque um simples olhar seu derrete qualquer resistência. Eufórico como se tivesse conquistado o universo. Apavorado porque nem sei como mereço algo tão lindo. \nNão dá pra explicar direito. Só sei que, quando você me olha assim, eu descubro o homem que quero ser, alguém que faça você se sentir tão incrível quanto você me faz sentir. É como alcançar o impossível e perceber que ele estava aqui o tempo todo, nos seus olhos. Obrigado por me deixar viver esse paradoxo gostoso que é te amar. Te amo mais que o Homem-Aranha ama a Mary Jane.",
    //7
    "Minha princesa, hoje eu quero celebrar uma das coisas que mais amo fazer com você que é transformar nossos sonhos e metas em realidade. Não é só sobre o futuro que a gente planeja, é sobre cada passo, cada detalhe, cada 'e se a gente fizer tal coisa?' que vira um 'vamos'. Tudo é mais especial porque é nosso. Eu amo o brilho no seu olho quando você fala dos nossos planos. A sua mão na minha enquanto a gente lista metas. O jeito que você me puxa pra cima quando eu duvido que algo vai dar certo. Você me ensinou que amor não é só sentir, é construir. E eu não quero ninguém além de você pra ser minha parceira nessa obra sem fim. Porque mesmo nos planos que falham, a gente sempre aprende e no fim, o que importa é estar do seu lado. \nEu te amo meu bem.",
    //8
    "Meu amor, mal posso acreditar que em poucos dias estaremos em Poços de Caldas, celebrando nosso primeiro ano de amor (um pouquinho fora do dia certo). Tô com aquela sensação gostosa de ansiedade de quem vai viver um sonho loguinho. Já imagino a gente andando de mãos dadas pelas ruas de pedra, explorando cada cantinho da cidade. O café da manhã com você toda enroladinha no roupão(esqueci o nome do trem quentinho que você tem). O nosso almoço romântico no dia 27, onde vou te olhar e pensar, igual todas as vezes, 'como eu tive sorte de te encontrar'. E pensar que isso é só o começo. Cada ano, cada viagem, cada momento ao seu lado será um novo capítulo que eu vou amar escrever com você. Obrigado por ser minha companheira de aventuras, meu amor de todos os dias e minha razão para comemorar a vida.",
    //9
    "Minha princesa, confesso que já comecei a quebrar a cabeça (no melhor sentido) pensando no seu presente de 1 ano. Não é só um presente, é um pedacinho do que sinto por você e por isso tem que ser tão especial quanto nosso amor. Já perdi horas pensando em cada detalhe que faça seus olhos brilharem e imaginando sua reação quando você abrir (torcendo pra você não adivinhar antes ou eu te contar). Mas saiba que, mesmo que eu encontre o presente perfeito, ele nunca vai superar o maior presente que já ganhei que foi ter você na minha vida nesse primeiro ano incrível.\nTe amo muito mais do que qualquer presente que eu vá te dar em nosso namoro",
    //10
    "Minha vida, já parou pra pensar como nosso amor é como uma planta especial? No começo era um brotinho frágil, mas hoje vejo como crescemos juntos, regamos com risadas das nossas bobagens, adubamos com paciência nos dias difíceis, podamos com cuidado o que não nos faz bem, criamos nossa própria estufa de amor e cumplicidade, e colhemos momentos que guardo como tesouros (minhas melhores memórias são ao seu lado). E sabe o que eu acho mais bonito? Ainda tem tanta coisa pra florescer na nossa relação. Cada eu te amo seu é como sol na minha vida. Obrigado por ser meu jardim e minha jardineira. \nMal posso esperar para plantar novas memórias em Poços de Caldas!\nEu te amo muito meu bem.",
    //11
    "Minha vida, hoje quero te dizer o que guardo no lugar mais profundo do meu coração, como diz meu amigo djavan na musica de hoje \n''O que há dentro do meu coração \nEu tenho guardado pra te dar\nE todas as horas que o tempo tem pra me conceder\nSão tuas, até morrer''\nA cada dia descubro como te adoro em tudo, no seu jeito, nas suas manias, no seu olhar em como eu te quero mais que tudo, construir nossa história em qualquer lugar, seja num céu azul ou numa tempestade, prometo ser só seu em todos os versos da nossa canção.\nNão importa onde estejamos, em Poços de Caldas, em Santos, em São Paulo, em casa, ou no fim do mundo contigo, até o lugar mais cinza vira um paraíso. Porque você é minha eterna paisagem favorita, meu agora e meu depois, a grande história que sempre quis viver\nTe amo com um amor que ainda está descobrindo sua própria força",
    //12
    "Meu amor, nos dias em que o mundo parece pesado demais, você chega com seu abraço que aquece a alma e seu sorriso que ilumina até a noite mais escura. Você não sabe, mas quando chego em casa e vejo sua mensagem no celular, quando você me puxa pra abraçar e beijar sem motivo, quando faz aquele cafuné do jeito que eu gosto, sem eu precisar pedir, são nesses detalhes que mora a magia de ter você. E hoje quero te prometer que vou ser seu porto seguro nos dias de tempestade, vou lembrar você da força que você nem sabe que tem, vou te devolver todo o conforto que você me dá. Porque, pra mim, amar e ser amado é isso, ter um abrigo aconchegante onde até a segunda-feira mais difícil vira suportável quando estamos juntos. Obrigado por ser minha luz. Espero que um dia eu consiga ser essa mesma luz para você. \nEu te amo mais que tudo nessa vida Heloisa Pimentel.",
    //13
    "Sabia que, para mim, nosso amor tem o aconchego do refrão dessa música, igual nossos domingos debaixo das cobertas, a harmonia perfeita porque mesmo nos dias desafinados, a gente sempre encontra o ritmo. Você é minha playlist favorita que nunca canso de ouvir, a música que acalma meu coração nos dias barulhentos, a melodia que embala meus pensamentos antes de dormir. Nosso ''cobertor de orelha'' é seu jeito de se enrolar em mim quando bate frio, meus dedos afundando no seu cabelo durante o filme, aquele instante em que você vira e sussurra:''Nem liga o replay, fica mais um pouco''.\n Prometo sempre ser seu alto-falante quando precisar desabafar, sua música animada nos dias tristes e seu silêncio confortável quando o mundo for muito barulhento. Obrigado por ser a trilha sonora da minha vida. Te amo muitão.",
    //14
    "Que o dia 14 seja incrível! 🌟",
    //15
    "Que o dia 15 seja incrível! 🌟",
    //16
    "Que o dia 16 seja incrível! 🌟",
    //17
    "Que o dia 17 seja incrível! 🌟",
    //18
    "Que o dia 18 seja incrível! 🌟",
    //19
    "Que o dia 19 seja incrível! 🌟",
    //20
    "Que o dia 20 seja incrível! 🌟",
    //21
    "Que o dia 21 seja incrível! 🌟",
    //22
    "Que o dia 22 seja incrível! 🌟",
    //23
    "Que o dia 23 seja incrível! 🌟",
    //24
    "Que o dia 24 seja incrível! 🌟",
    //25
    "Que o dia 25 seja incrível! 🌟",
    //26
    "Que o dia 26 seja incrível! 🌟",
    //27
    "Que o dia 27 seja incrível! 🌟",
    //28
    "Que o dia 28 seja incrível! 🌟",
    //29
    "Que o dia 29 seja incrível! 🌟",
    //30
    "Última mensagem para o dia 30! 🎉"
];

mensagens[26] = "❤️ Mensagem SUPER especial para o dia 27/04! ❤️";

const musicas = [
    "music/musica1.mp3",
    "music/musica2.mp3",
    "music/musica3.mp3",
    "music/musica4.mp3",
    "music/musica5.mp3",
    "music/musica6.mp3",
    "music/musica7.mp3",
    "music/musica8.mp3",
    "music/musica9.mp3",
    "music/musica10.mp3",
    "music/musica11.mp3",
    "music/musica12.mp3",
    "music/musica13.mp3",
    "music/musica14.mp3",
    "music/musica15.mp3",
    "music/musica16.mp3",
    "music/musica17.mp3",
    "music/musica18.mp3",
    "music/musica19.mp3",
    "music/musica21.mp3",
    "music/musica22.mp3",
    "music/musica23.mp3",
    "music/musica24.mp3",
    "music/musica25.mp3",
    "music/musica26.mp3",
    "music/musica27.mp3",
    "music/musica28.mp3",
    "music/musica29.mp3",
    "music/musica30.mp3",
];

// Variável para controlar o evento de clique fora
let outsideClickHandler = null;

function showError(message) {
    const errorPopup = document.getElementById('error-popup');
    const errorMessage = document.getElementById('error-message');
    const errorClose = errorPopup.querySelector('.error__close');
    
    // Remove o handler anterior se existir
    if (outsideClickHandler) {
        document.removeEventListener('click', outsideClickHandler);
    }
    
    errorMessage.textContent = message;
    errorPopup.style.display = 'flex';
    
    // Fechar ao clicar no X
    errorClose.onclick = function() {
        errorPopup.style.display = 'none';
        if (outsideClickHandler) {
            document.removeEventListener('click', outsideClickHandler);
            outsideClickHandler = null;
        }
    };
    
    // Novo handler para clique fora
    outsideClickHandler = function(e) {
        if (!errorPopup.contains(e.target)) {
            errorPopup.style.display = 'none';
            document.removeEventListener('click', outsideClickHandler);
            outsideClickHandler = null;
        }
    };
    
    // Adiciona o event listener após um pequeno delay
    setTimeout(() => {
        document.addEventListener('click', outsideClickHandler);
    }, 10);
    
    // Fechar automaticamente após 5 segundos
    setTimeout(() => {
        errorPopup.style.display = 'none';
        if (outsideClickHandler) {
            document.removeEventListener('click', outsideClickHandler);
            outsideClickHandler = null;
        }
    }, 5000);
}



$(document).ready(function () {
    // Primeiro, carregue todas as imagens e depois inicialize o slider
    const imagePaths = [
        "images/imagem1.jpeg", "images/imagem2.jpeg", "images/imagem3.jpeg",
        "images/imagem4.jpeg", "images/imagem5.jpeg", "images/imagem6.jpeg",
        "images/imagem7.jpeg", "images/imagem8.jpeg", "images/imagem17.jpeg",
        "images/imagem18.jpeg", "images/imagem27.jpeg", "images/imagem9.jpeg",
        "images/imagem16.jpeg", "images/imagem19.jpeg", "images/imagem26.jpeg",
        "images/imagem10.jpeg", "images/imagem15.jpeg", "images/imagem20.jpeg",
        "images/imagem25.jpeg", "images/imagem11.jpeg", "images/imagem14.jpeg",
        "images/imagem21.jpeg", "images/imagem24.jpeg", "images/imagem12.jpeg",
        "images/imagem13.jpeg", "images/imagem22.jpeg", "images/imagem23.jpeg"
    ];

    const slider = document.getElementById("slider");

    // Carregar todas as imagens primeiro
    const loadImages = imagePaths.map(path => {
        return new Promise((resolve) => {
            convertImageToBase64(path, function (base64Image) {
                let imgElement = document.createElement("img");
                imgElement.src = base64Image;
                slider.appendChild(imgElement);
                resolve();
            });
        });
    });

    // Quando todas as imagens estiverem carregadas, inicialize o slider
    Promise.all(loadImages).then(() => {
        $('.slider').slick({
            dots: true,
            infinite: true,
            speed: 500,
            slidesToShow: 1,
            slidesToScroll: 1,
            autoplay: true,
            autoplaySpeed: 3000
        });
    });

    // Restante do seu código para as cartinhas
    const today = new Date();
    // Definimos um ano fixo (pode ser o ano atual) e o mês de abril (3, pois janeiro é 0)
    const startDate = new Date(today.getFullYear(), 3, 1); // 1 de abril do ano atual

    const cardsContainer = document.getElementById("cards-container");

    for (let i = 1; i <= 30; i++) {
        const releaseDate = new Date(startDate);
        releaseDate.setDate(startDate.getDate() + i - 1); // Dias de abril (1 a 30)

        const bookDiv = document.createElement("div");
        bookDiv.classList.add("book");

        const text = document.createElement("p");
        text.innerText = `${i}`;
        text.dataset.message = mensagens[i - 1]; // Armazena a mensagem correspondente

        const coverDiv = document.createElement("div");
        coverDiv.classList.add("cover");

        // Verifica se é o dia 27/04
        const isSpecialDay = i === 27; // Dia 27 é sempre especial

        if (today < releaseDate) {
            coverDiv.classList.add("disabled");
            coverDiv.innerHTML = `<p>Disponível em ${releaseDate.getDate()}/04/${releaseDate.getFullYear()}</p>`;
        } else {
            coverDiv.innerHTML = isSpecialDay
                ? `<div class="special-content">
                     <p>Clique para revelar</p>
                     <button class="heart-button">
                         <svg height="32" width="32" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                             <path d="M0 0H24V24H0z" fill="none"></path>
                             <path d="M16.5 3C19.538 3 22 5.5 22 9c0 7-7.5 11-10 12.5C9.5 20 2 16 2 9c0-3.5 2.5-6 5.5-6C9.36 3 11 4 12 5c1-1 2.64-2 4.5-2z"></path>
                         </svg>
                     </button>
                   </div>`
                : `<p>Clique para revelar</p>`;
        }

        coverDiv.addEventListener("click", function () {
            if (today < releaseDate) {
                // Fecha qualquer pop-up existente antes de mostrar um novo
                const existingPopup = document.getElementById('error-popup');
                if (existingPopup) {
                    existingPopup.style.display = 'none';
                    if (outsideClickHandler) {
                        document.removeEventListener('click', outsideClickHandler);
                        outsideClickHandler = null;
                    }
                }
                showError(`Esta cartinha só poderá ser aberta em ${releaseDate.getDate()}/04/${releaseDate.getFullYear()}`);
            } else {
                this.classList.toggle('open');
                text.innerText = this.classList.contains('open')
                    ? text.dataset.message
                    : `Cartinha ${i}`;
                    if (this.classList.contains('open')) {
                        playMusic(musicas[i - 1]);
                    }
            }
        });

        if (isSpecialDay && !(today < releaseDate)) {
            const heartButton = coverDiv.querySelector('.heart-button');
            if (heartButton) {
                heartButton.addEventListener('click', function (e) {
                    e.stopPropagation();
                    text.innerText = text.dataset.message;
                    playMusic(musicas[i - 1]); // Toca a música especial
                });
            }
        }

        bookDiv.appendChild(text);
        bookDiv.appendChild(coverDiv);
        cardsContainer.appendChild(bookDiv);
    }
});

function convertImageToBase64(url, callback) {
    let xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.responseType = 'blob';
    xhr.onload = function () {
        let reader = new FileReader();
        reader.readAsDataURL(xhr.response);
        reader.onloadend = function () {
            callback(reader.result);
        };
    };
    xhr.send();
}


let currentAudio = null;

function playMusic(musicPath) {
    // Para a música atual se estiver tocando
    if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
    }
    
    // Toca a nova música
    currentAudio = new Audio(musicPath);
    currentAudio.volume = 0.05; // 30% do volume (ajuste este valor entre 0 e 1)
    currentAudio.play().catch(e => console.log("Erro ao tocar música:", e));
}

// Variável para controlar o estado da música
let isMusicPlaying = false;

// Elementos do controle
const pausePlayBtn = document.getElementById('pause-play-btn');

// Função para atualizar o ícone do botão
function updateButtonIcon() {
    if (currentAudio && !currentAudio.paused) {
        pausePlayBtn.textContent = "⏸️";
        isMusicPlaying = true;
    } else {
        pausePlayBtn.textContent = "▶️";
        isMusicPlaying = false;
    }
}

// Evento de clique no botão
pausePlayBtn.addEventListener('click', function() {
    if (currentAudio) {
        if (isMusicPlaying) {
            currentAudio.pause();
        } else {
            currentAudio.play().catch(e => console.log("Erro ao tocar música:", e));
        }
        updateButtonIcon();
    }
});

// Atualize a função playMusic para incluir o controle
function playMusic(musicPath) {
    if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
    }
    currentAudio = new Audio(musicPath);
    currentAudio.volume = 0.3; // Volume padrão
    currentAudio.play().catch(e => console.log("Erro ao tocar música:", e));
    
    // Atualiza o botão quando a música começa
    currentAudio.onplay = function() {
        updateButtonIcon();
    };
    
    // Atualiza o botão quando a música termina
    currentAudio.onended = function() {
        updateButtonIcon();
    };
    
    // Atualiza o botão se ocorrer um erro
    currentAudio.onerror = function() {
        updateButtonIcon();
    };
}

// Inicializa o botão como pausado no carregamento
updateButtonIcon();

// Força o navegador a buscar uma nova versão do arquivo
window.addEventListener('load', function() {
    if('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(function(registrations) {
        for(let registration of registrations) {
          registration.unregister();
        }
      });
    }
    
    // Limpa o cache quando a página carrega
    if('caches' in window) {
      caches.keys().then(function(names) {
        for(let name of names) {
          caches.delete(name);
        }
      });
    }
  });
