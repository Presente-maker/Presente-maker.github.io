const mensagens = [
    //1
    "Oi minha princesa, este mini projetinho √© para o m√™s mais especial do ano, o m√™s em que comemoramos 1 ano de namoro, nessa primeira cartinha n√£o irei me estender muito apenas para te deixar na curiosidade. Espero que a senhorita n√£o roube e veja no c√≥dido todas as mensagens de uma vez. Eu te amo muito e espero que a declara√ß√£o di√°ria durante este m√™s te deixe feliz.üíú",
    //2
    "Meu amor, hoje quero te dizer o quanto voc√™ ilumina meus dias. Desde que voc√™ entrou na minha vida, tudo ganhou mais cor, mais significado. Seu sorriso √© meu conforto, seu abra√ßo √© meu ref√∫gio, e seu amor √© a for√ßa que me move.Voc√™ n√£o imagina o bem que me faz s√≥ por existir. Sua voz acalma meus medos, sua risada contagia minha alma, e sua presen√ßa transforma at√© os dias mais cinzas em algo especial. √â como se o universo tivesse me dado um presente que eu nem sabia que precisava, mas que agora n√£o consigo mais viver sem. Eu te amo n√£o s√≥ pelo que voc√™ √©, mas pelo que eu me torno quando estou com voc√™.",
    //3
    "Minha princesa, hoje quero te dizer que ter voc√™ √© o maior presente que a vida me deu. Cada instante ao seu lado √© como uma p√°gina de um conto perfeito, e o melhor √© pensar que essa hist√≥ria est√° s√≥ come√ßando. Eu amo o jeito que voc√™ me olha, como se eu fosse seu mundo inteiro. Amo nossos planos bobos, nossos sonhos e at√© os sil√™ncios que a gente compartilha, porque tudo com voc√™ faz sentido. Quero acordar com voc√™ todos os dias, ver seu sorriso antes mesmo do caf√©, construir uma vida cheia de mem√≥rias e conquistas juntos. Quero envelhecer ao seu lado e, mesmo daqui a 50 anos, ainda te olhar com o mesmo amor e admira√ß√£o de hoje. Eu te amo hoje, amanh√£ e em todos os cap√≠tulos que ainda vamos escrever. ",
    //4
    "Acordar e lembrar que voc√™ √© minha namorada √© como ganhar um presente novo todo dia. Voc√™ sabe aquela sensa√ß√£o de tomar um leite quente numa manh√£/dia frio? √â assim que meu cora√ß√£o fica quando penso em voc√™. Eu amo os detalhes que fazem a gente ser a gente, o jeito que voc√™ me manda dorme bem mesmo quando t√° com sono, nossas conversas sem p√© nem cabe√ßa at√© o meio da madrugada, como seu abra√ßo parece ajustar perfeitamente no meu. Mas o que mais me derrete √© saber que, n√£o importa o dia que eu tiver, sempre vou ter voc√™ do meu lado, a minha torcedora favorita, minha parceira de aventuras e minha c√∫mplice em tudo. Hoje s√≥ queria mesmo dizer: obrigado por existir do jeito que voc√™ existe. Meu mundo √© infinitamente melhor com voc√™ nele. Te amo mais que ontem, mas menos que amanh√£.‚ò∫üíú",
    //5
    "Meu amor, n√£o existe sensa√ß√£o no mundo que se compare √† de ficar acordado te observando dormir. Quando a noite cai e a gente se enrola nos cobertores, eu me permito um luxo que s√≥ voc√™ me d√° que √© a de fazer carinho no seu cabelo devagar, sentir sua respira√ß√£o ficando calma, e assistir seus olhos pesarem at√© voc√™ fugir pro mundo dos sonhos (com direito a musicas de ninar). √â como se, naqueles minutos, o tempo parasse s√≥ pra gente.  E quando o sol nasce meu cora√ß√£o dispara, acordar e olhar pro lado, ainda com sono, e te ver ali, toda linda amassadinha do sono me lembra que o universo me deu um presente que eu nem merecia. As vezes fico uns minutinhos s√≥ te admirando, pensando 'Como algu√©m pode ser t√£o perfeita?'. Voc√™ n√£o faz ideia do poder que tem de transformar uma simples noite de sono num momento m√°gico. Eu poderia passar mil vidas repetindo isso e nunca cansaria. Obrigado por ser meu aconchego e meu melhor 'bom dia' (todos os dias remotamente e alguns dias pessoalmente). Eu te amo muit√£o (Caso queira saber sobre a musica mande mensagem ao SAC)",
    //6
    "(Parafraseando o que o Peter Parker disse um dia para Mary Jane) Meu amor, a melhor coisa em voc√™ n√£o √© s√≥ seu sorriso, seu jeito ou seu abra√ßo, √© quando nossos olhos se encontram e, por um segundo, o mundo para. √â a√≠ que eu sinto que sou mais forte, pois seu amor me d√° coragem de ser quem eu nunca fui. Mais fraco, porque um simples olhar seu derrete qualquer resist√™ncia. Euf√≥rico como se tivesse conquistado o universo. Apavorado porque nem sei como mere√ßo algo t√£o lindo. \nN√£o d√° pra explicar direito. S√≥ sei que, quando voc√™ me olha assim, eu descubro o homem que quero ser, algu√©m que fa√ßa voc√™ se sentir t√£o incr√≠vel quanto voc√™ me faz sentir. √â como alcan√ßar o imposs√≠vel e perceber que ele estava aqui o tempo todo, nos seus olhos. Obrigado por me deixar viver esse paradoxo gostoso que √© te amar. Te amo mais que o Homem-Aranha ama a Mary Jane.",
    //7
    "Minha princesa, hoje eu quero celebrar uma das coisas que mais amo fazer com voc√™ que √© transformar nossos sonhos e metas em realidade. N√£o √© s√≥ sobre o futuro que a gente planeja, √© sobre cada passo, cada detalhe, cada 'e se a gente fizer tal coisa?' que vira um 'vamos'. Tudo √© mais especial porque √© nosso. Eu amo o brilho no seu olho quando voc√™ fala dos nossos planos. A sua m√£o na minha enquanto a gente lista metas. O jeito que voc√™ me puxa pra cima quando eu duvido que algo vai dar certo. Voc√™ me ensinou que amor n√£o √© s√≥ sentir, √© construir. E eu n√£o quero ningu√©m al√©m de voc√™ pra ser minha parceira nessa obra sem fim. Porque mesmo nos planos que falham, a gente sempre aprende e no fim, o que importa √© estar do seu lado. \nEu te amo meu bem.",
    //8
    "Meu amor, mal posso acreditar que em poucos dias estaremos em Po√ßos de Caldas, celebrando nosso primeiro ano de amor (um pouquinho fora do dia certo). T√¥ com aquela sensa√ß√£o gostosa de ansiedade de quem vai viver um sonho loguinho. J√° imagino a gente andando de m√£os dadas pelas ruas de pedra, explorando cada cantinho da cidade. O caf√© da manh√£ com voc√™ toda enroladinha no roup√£o(esqueci o nome do trem quentinho que voc√™ tem). O nosso almo√ßo rom√¢ntico no dia 27, onde vou te olhar e pensar, igual todas as vezes, 'como eu tive sorte de te encontrar'. E pensar que isso √© s√≥ o come√ßo. Cada ano, cada viagem, cada momento ao seu lado ser√° um novo cap√≠tulo que eu vou amar escrever com voc√™. Obrigado por ser minha companheira de aventuras, meu amor de todos os dias e minha raz√£o para comemorar a vida.",
    //9
    "Minha princesa, confesso que j√° comecei a quebrar a cabe√ßa (no melhor sentido) pensando no seu presente de 1 ano. N√£o √© s√≥ um presente, √© um pedacinho do que sinto por voc√™ e por isso tem que ser t√£o especial quanto nosso amor. J√° perdi horas pensando em cada detalhe que fa√ßa seus olhos brilharem e imaginando sua rea√ß√£o quando voc√™ abrir (torcendo pra voc√™ n√£o adivinhar antes ou eu te contar). Mas saiba que, mesmo que eu encontre o presente perfeito, ele nunca vai superar o maior presente que j√° ganhei que foi ter voc√™ na minha vida nesse primeiro ano incr√≠vel.\nTe amo muito mais do que qualquer presente que eu v√° te dar em nosso namoro",
    //10
    "Minha vida, j√° parou pra pensar como nosso amor √© como uma planta especial? No come√ßo era um brotinho fr√°gil, mas hoje vejo como crescemos juntos, regamos com risadas das nossas bobagens, adubamos com paci√™ncia nos dias dif√≠ceis, podamos com cuidado o que n√£o nos faz bem, criamos nossa pr√≥pria estufa de amor e cumplicidade, e colhemos momentos que guardo como tesouros (minhas melhores mem√≥rias s√£o ao seu lado). E sabe o que eu acho mais bonito? Ainda tem tanta coisa pra florescer na nossa rela√ß√£o. Cada eu te amo seu √© como sol na minha vida. Obrigado por ser meu jardim e minha jardineira. \nMal posso esperar para plantar novas mem√≥rias em Po√ßos de Caldas!\nEu te amo muito meu bem.",
    //11
    "Minha vida, hoje quero te dizer o que guardo no lugar mais profundo do meu cora√ß√£o, como diz meu amigo djavan na musica de hoje \n''O que h√° dentro do meu cora√ß√£o \nEu tenho guardado pra te dar\nE todas as horas que o tempo tem pra me conceder\nS√£o tuas, at√© morrer''\nA cada dia descubro como te adoro em tudo, no seu jeito, nas suas manias, no seu olhar em como eu te quero mais que tudo, construir nossa hist√≥ria em qualquer lugar, seja num c√©u azul ou numa tempestade, prometo ser s√≥ seu em todos os versos da nossa can√ß√£o.\nN√£o importa onde estejamos, em Po√ßos de Caldas, em Santos, em S√£o Paulo, em casa, ou no fim do mundo contigo, at√© o lugar mais cinza vira um para√≠so. Porque voc√™ √© minha eterna paisagem favorita, meu agora e meu depois, a grande hist√≥ria que sempre quis viver\nTe amo com um amor que ainda est√° descobrindo sua pr√≥pria for√ßa",
    //12
    "Meu amor, nos dias em que o mundo parece pesado demais, voc√™ chega com seu abra√ßo que aquece a alma e seu sorriso que ilumina at√© a noite mais escura. Voc√™ n√£o sabe, mas quando chego em casa e vejo sua mensagem no celular, quando voc√™ me puxa pra abra√ßar e beijar sem motivo, quando faz aquele cafun√© do jeito que eu gosto, sem eu precisar pedir, s√£o nesses detalhes que mora a magia de ter voc√™. E hoje quero te prometer que vou ser seu porto seguro nos dias de tempestade, vou lembrar voc√™ da for√ßa que voc√™ nem sabe que tem, vou te devolver todo o conforto que voc√™ me d√°. Porque, pra mim, amar e ser amado √© isso, ter um abrigo aconchegante onde at√© a segunda-feira mais dif√≠cil vira suport√°vel quando estamos juntos. Obrigado por ser minha luz. Espero que um dia eu consiga ser essa mesma luz para voc√™. \nEu te amo mais que tudo nessa vida Heloisa Pimentel.",
    //13
    "Sabia que, para mim, nosso amor tem o aconchego do refr√£o dessa m√∫sica, igual nossos domingos debaixo das cobertas, a harmonia perfeita porque mesmo nos dias desafinados, a gente sempre encontra o ritmo. Voc√™ √© minha playlist favorita que nunca canso de ouvir, a m√∫sica que acalma meu cora√ß√£o nos dias barulhentos, a melodia que embala meus pensamentos antes de dormir. Nosso ''cobertor de orelha'' √© seu jeito de se enrolar em mim quando bate frio, meus dedos afundando no seu cabelo durante o filme, aquele instante em que voc√™ vira e sussurra:''Nem liga o replay, fica mais um pouco''.\n Prometo sempre ser seu alto-falante quando precisar desabafar, sua m√∫sica animada nos dias tristes e seu sil√™ncio confort√°vel quando o mundo for muito barulhento. Obrigado por ser a trilha sonora da minha vida. Te amo muit√£o.",
    //14
    "Que o dia 14 seja incr√≠vel! üåü",
    //15
    "Que o dia 15 seja incr√≠vel! üåü",
    //16
    "Que o dia 16 seja incr√≠vel! üåü",
    //17
    "Que o dia 17 seja incr√≠vel! üåü",
    //18
    "Que o dia 18 seja incr√≠vel! üåü",
    //19
    "Que o dia 19 seja incr√≠vel! üåü",
    //20
    "Que o dia 20 seja incr√≠vel! üåü",
    //21
    "Que o dia 21 seja incr√≠vel! üåü",
    //22
    "Que o dia 22 seja incr√≠vel! üåü",
    //23
    "Que o dia 23 seja incr√≠vel! üåü",
    //24
    "Que o dia 24 seja incr√≠vel! üåü",
    //25
    "Que o dia 25 seja incr√≠vel! üåü",
    //26
    "Que o dia 26 seja incr√≠vel! üåü",
    //27
    "Que o dia 27 seja incr√≠vel! üåü",
    //28
    "Que o dia 28 seja incr√≠vel! üåü",
    //29
    "Que o dia 29 seja incr√≠vel! üåü",
    //30
    "√öltima mensagem para o dia 30! üéâ"
];

mensagens[26] = "‚ù§Ô∏è Mensagem SUPER especial para o dia 27/04! ‚ù§Ô∏è";

const musicas = [
    "music/musica1.mp3",
    "music/musica2.mp3",
    "music/musica3.mp3",
    "music/musica4.mp3",
    "music/musica5.mp3",
    "music/musica6.mp3",
    "music/musica7.mp3",
    "music/musica8.mp3",
    "music/musica9.mp3",
    "music/musica10.mp3",
    "music/musica11.mp3",
    "music/musica12.mp3",
    "music/musica13.mp3",
    "music/musica14.mp3",
    "music/musica15.mp3",
    "music/musica16.mp3",
    "music/musica17.mp3",
    "music/musica18.mp3",
    "music/musica19.mp3",
    "music/musica21.mp3",
    "music/musica22.mp3",
    "music/musica23.mp3",
    "music/musica24.mp3",
    "music/musica25.mp3",
    "music/musica26.mp3",
    "music/musica27.mp3",
    "music/musica28.mp3",
    "music/musica29.mp3",
    "music/musica30.mp3",
];

// Vari√°vel para controlar o evento de clique fora
let outsideClickHandler = null;

function showError(message) {
    const errorPopup = document.getElementById('error-popup');
    const errorMessage = document.getElementById('error-message');
    const errorClose = errorPopup.querySelector('.error__close');
    
    // Remove o handler anterior se existir
    if (outsideClickHandler) {
        document.removeEventListener('click', outsideClickHandler);
    }
    
    errorMessage.textContent = message;
    errorPopup.style.display = 'flex';
    
    // Fechar ao clicar no X
    errorClose.onclick = function() {
        errorPopup.style.display = 'none';
        if (outsideClickHandler) {
            document.removeEventListener('click', outsideClickHandler);
            outsideClickHandler = null;
        }
    };
    
    // Novo handler para clique fora
    outsideClickHandler = function(e) {
        if (!errorPopup.contains(e.target)) {
            errorPopup.style.display = 'none';
            document.removeEventListener('click', outsideClickHandler);
            outsideClickHandler = null;
        }
    };
    
    // Adiciona o event listener ap√≥s um pequeno delay
    setTimeout(() => {
        document.addEventListener('click', outsideClickHandler);
    }, 10);
    
    // Fechar automaticamente ap√≥s 5 segundos
    setTimeout(() => {
        errorPopup.style.display = 'none';
        if (outsideClickHandler) {
            document.removeEventListener('click', outsideClickHandler);
            outsideClickHandler = null;
        }
    }, 5000);
}



$(document).ready(function () {
    // Primeiro, carregue todas as imagens e depois inicialize o slider
    const imagePaths = [
        "images/imagem1.jpeg", "images/imagem2.jpeg", "images/imagem3.jpeg",
        "images/imagem4.jpeg", "images/imagem5.jpeg", "images/imagem6.jpeg",
        "images/imagem7.jpeg", "images/imagem8.jpeg", "images/imagem17.jpeg",
        "images/imagem18.jpeg", "images/imagem27.jpeg", "images/imagem9.jpeg",
        "images/imagem16.jpeg", "images/imagem19.jpeg", "images/imagem26.jpeg",
        "images/imagem10.jpeg", "images/imagem15.jpeg", "images/imagem20.jpeg",
        "images/imagem25.jpeg", "images/imagem11.jpeg", "images/imagem14.jpeg",
        "images/imagem21.jpeg", "images/imagem24.jpeg", "images/imagem12.jpeg",
        "images/imagem13.jpeg", "images/imagem22.jpeg", "images/imagem23.jpeg"
    ];

    const slider = document.getElementById("slider");

    // Carregar todas as imagens primeiro
    const loadImages = imagePaths.map(path => {
        return new Promise((resolve) => {
            convertImageToBase64(path, function (base64Image) {
                let imgElement = document.createElement("img");
                imgElement.src = base64Image;
                slider.appendChild(imgElement);
                resolve();
            });
        });
    });

    // Quando todas as imagens estiverem carregadas, inicialize o slider
    Promise.all(loadImages).then(() => {
        $('.slider').slick({
            dots: true,
            infinite: true,
            speed: 500,
            slidesToShow: 1,
            slidesToScroll: 1,
            autoplay: true,
            autoplaySpeed: 3000
        });
    });

    // Restante do seu c√≥digo para as cartinhas
    const today = new Date();
    // Definimos um ano fixo (pode ser o ano atual) e o m√™s de abril (3, pois janeiro √© 0)
    const startDate = new Date(today.getFullYear(), 3, 1); // 1 de abril do ano atual

    const cardsContainer = document.getElementById("cards-container");

    for (let i = 1; i <= 30; i++) {
        const releaseDate = new Date(startDate);
        releaseDate.setDate(startDate.getDate() + i - 1); // Dias de abril (1 a 30)

        const bookDiv = document.createElement("div");
        bookDiv.classList.add("book");

        const text = document.createElement("p");
        text.innerText = `${i}`;
        text.dataset.message = mensagens[i - 1]; // Armazena a mensagem correspondente

        const coverDiv = document.createElement("div");
        coverDiv.classList.add("cover");

        // Verifica se √© o dia 27/04
        const isSpecialDay = i === 27; // Dia 27 √© sempre especial

        if (today < releaseDate) {
            coverDiv.classList.add("disabled");
            coverDiv.innerHTML = `<p>Dispon√≠vel em ${releaseDate.getDate()}/04/${releaseDate.getFullYear()}</p>`;
        } else {
            coverDiv.innerHTML = isSpecialDay
                ? `<div class="special-content">
                     <p>Clique para revelar</p>
                     <button class="heart-button">
                         <svg height="32" width="32" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                             <path d="M0 0H24V24H0z" fill="none"></path>
                             <path d="M16.5 3C19.538 3 22 5.5 22 9c0 7-7.5 11-10 12.5C9.5 20 2 16 2 9c0-3.5 2.5-6 5.5-6C9.36 3 11 4 12 5c1-1 2.64-2 4.5-2z"></path>
                         </svg>
                     </button>
                   </div>`
                : `<p>Clique para revelar</p>`;
        }

        coverDiv.addEventListener("click", function () {
            if (today < releaseDate) {
                // Fecha qualquer pop-up existente antes de mostrar um novo
                const existingPopup = document.getElementById('error-popup');
                if (existingPopup) {
                    existingPopup.style.display = 'none';
                    if (outsideClickHandler) {
                        document.removeEventListener('click', outsideClickHandler);
                        outsideClickHandler = null;
                    }
                }
                showError(`Esta cartinha s√≥ poder√° ser aberta em ${releaseDate.getDate()}/04/${releaseDate.getFullYear()}`);
            } else {
                this.classList.toggle('open');
                text.innerText = this.classList.contains('open')
                    ? text.dataset.message
                    : `Cartinha ${i}`;
                    if (this.classList.contains('open')) {
                        playMusic(musicas[i - 1]);
                    }
            }
        });

        if (isSpecialDay && !(today < releaseDate)) {
            const heartButton = coverDiv.querySelector('.heart-button');
            if (heartButton) {
                heartButton.addEventListener('click', function (e) {
                    e.stopPropagation();
                    text.innerText = text.dataset.message;
                    playMusic(musicas[i - 1]); // Toca a m√∫sica especial
                });
            }
        }

        bookDiv.appendChild(text);
        bookDiv.appendChild(coverDiv);
        cardsContainer.appendChild(bookDiv);
    }
});

function convertImageToBase64(url, callback) {
    let xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.responseType = 'blob';
    xhr.onload = function () {
        let reader = new FileReader();
        reader.readAsDataURL(xhr.response);
        reader.onloadend = function () {
            callback(reader.result);
        };
    };
    xhr.send();
}


let currentAudio = null;

function playMusic(musicPath) {
    // Para a m√∫sica atual se estiver tocando
    if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
    }
    
    // Toca a nova m√∫sica
    currentAudio = new Audio(musicPath);
    currentAudio.volume = 0.05; // 30% do volume (ajuste este valor entre 0 e 1)
    currentAudio.play().catch(e => console.log("Erro ao tocar m√∫sica:", e));
}

// Vari√°vel para controlar o estado da m√∫sica
let isMusicPlaying = false;

// Elementos do controle
const pausePlayBtn = document.getElementById('pause-play-btn');

// Fun√ß√£o para atualizar o √≠cone do bot√£o
function updateButtonIcon() {
    if (currentAudio && !currentAudio.paused) {
        pausePlayBtn.textContent = "‚è∏Ô∏è";
        isMusicPlaying = true;
    } else {
        pausePlayBtn.textContent = "‚ñ∂Ô∏è";
        isMusicPlaying = false;
    }
}

// Evento de clique no bot√£o
pausePlayBtn.addEventListener('click', function() {
    if (currentAudio) {
        if (isMusicPlaying) {
            currentAudio.pause();
        } else {
            currentAudio.play().catch(e => console.log("Erro ao tocar m√∫sica:", e));
        }
        updateButtonIcon();
    }
});

// Atualize a fun√ß√£o playMusic para incluir o controle
function playMusic(musicPath) {
    if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
    }
    currentAudio = new Audio(musicPath);
    currentAudio.volume = 0.3; // Volume padr√£o
    currentAudio.play().catch(e => console.log("Erro ao tocar m√∫sica:", e));
    
    // Atualiza o bot√£o quando a m√∫sica come√ßa
    currentAudio.onplay = function() {
        updateButtonIcon();
    };
    
    // Atualiza o bot√£o quando a m√∫sica termina
    currentAudio.onended = function() {
        updateButtonIcon();
    };
    
    // Atualiza o bot√£o se ocorrer um erro
    currentAudio.onerror = function() {
        updateButtonIcon();
    };
}

// Inicializa o bot√£o como pausado no carregamento
updateButtonIcon();

// For√ßa o navegador a buscar uma nova vers√£o do arquivo
window.addEventListener('load', function() {
    if('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(function(registrations) {
        for(let registration of registrations) {
          registration.unregister();
        }
      });
    }
    
    // Limpa o cache quando a p√°gina carrega
    if('caches' in window) {
      caches.keys().then(function(names) {
        for(let name of names) {
          caches.delete(name);
        }
      });
    }
  });
